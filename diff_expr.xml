<tool id="my_dexpr" name="Run differential expression analysis" version="0.1.0">
<requirements>
    <!-- <requirement type="set_environment">R_SCRIPT_PATH</requirement>-->
    <requirement type="package" >R</requirement>
    <requirement type="package" >DESeq2</requirement>
</requirements>

  <description>Run differential gene/exon usage analysis</description>
<!--   <command interpreter="Rscript"> run_deseq.R $counts $output $output2 $fittype
#for $N in $samples
  ${N.istreated} 
#end for
</command>  -->

<!--   dirty hack to change R version      -->
  <command interpreter="~/.Renv/versions/3.4.1/bin/Rscript"> run_dexpr.R -c $counts -o $output 
#if $method=="--deseqpar" or $method=="--deseqloc" or $method=="--deseq2par" or $method=="--deseq2loc"
-p $output2
#end if 
$method

#for $N in $samples
  ${N.sampletype} 
#end for


</command>
  <inputs>
    <param format="tabular" name="counts" type="data" optional="false" label="Input counted gene/exon hits"/>
    <param name="column" type="data_column"  data_ref="counts" label="Choose column"/>
    <repeat name="samples" title="Determine sample types" min="1" default="2">
      <param name="sampletype" label="Define type of each column in file (except first column, that contain gene name)" type="select">
        <option value="0"> Control </value>
        <option value="1"> Treated </value>
        <option value="-"> do not use this column at all </value>
      </param>
    </repeat>
    <param name="method" type="select" label="Methods">
      <option value="--deseqpar">DESeq parametric (default)</option>
      <option value="--deseqloc">DESeq local (mandatory for only one condition or lack of repeats)</option>
      <option value="--deseq2par">DESeq2 parametric (default)</option>
      <option value="--deseq2loc">DESeq2 local (mandatory for only one condition or lack of repeats)</option>
      <option value="--edgeR">edgeR</option>
      <option value="--metagenomeseqLog">metagenomeSeq log-normal model</option>
      <option value="--metagenomeseqZIG">metagenomeSeq ZIG (Zero-inflated Gaussian) model</option>
      <option value="--wilcoxon">Mann-Whitney-Wilcoxon test</option>
    </param>

  </inputs>
  <outputs>
        <data format="tabular" name="output"/>
        <data format="pdf" name="output2">
		<filter>method=="--deseqpar" or method=="--deseqloc" or method=="--deseq2par" or method=="--deseq2loc"</filter>
	</data>
  </outputs>

  <tests>
  </tests>

  <help>
    Run differential expression analysis with DESeq, DESeq2, edgeR, metagenomeSeq or simple Mann-Whitney-Wilcoxon test.

    Requires raw count table (with header) in format:
    gene/exon name	sample1		sample2		sample3 	....
    
    Filters out genes with too little counts.

    Returns table with mean values for conditions, foldChange, log2foldChange, p-value for each selected method.


Author: Julia
  </help>

</tool>

